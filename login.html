<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar Sesión</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <main class="container">
        <div style="display:flex; justify-content:flex-end; margin-bottom:8px;">
            <button id="theme-toggle" aria-label="Cambiar tema">☀️</button>
        </div>
        <h2>Iniciar Sesión</h2>
        <form id="login-form">
            <label for="username">Nombre de Usuario</label>
            <input id="username" name="username" type="text" required placeholder="Ingresa tu nombre de usuario">
            <label for="password">Contraseña</label>
            <input id="password" name="password" type="password" required placeholder="Ingresa tu contraseña">
            <label><input type="checkbox" id="remember"> Recordarme</label>
            <div style="margin-top:10px;">
                <button type="submit">Entrar</button>
            </div>
            <p id="msg" style="color:red"></p>
            <p style="margin-top:8px;">Si el usuario no existe, se creará una nueva cuenta con la contraseña proporcionada.</p>
        </form>
    </main>

    <script src="auth.js"></script>
    <script src="theme.js"></script>
    <script>
        (function(){
            function getParam(name){
                const p = new URLSearchParams(window.location.search);
                return p.get(name);
            }
            const form = document.getElementById('login-form');
            const msg = document.getElementById('msg');

            // Prefill username if remembered
            try{
                const remembered = localStorage.getItem('user') || sessionStorage.getItem('user');
                if(remembered){ document.getElementById('username').value = remembered; document.getElementById('remember').checked = !!localStorage.getItem('user'); }
            }catch(e){ }

            form.addEventListener('submit', function(e){
                e.preventDefault();
                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value;
                const r = document.getElementById('remember').checked;
                if(!window.Auth){ msg.textContent = 'Error: auth no disponible'; return; }
                const ok = window.Auth.login(username, password, r);
                if(!ok){ msg.textContent = 'Usuario o contraseña inválidos.'; return; }
                const next = getParam('next') || 'index.html';
                window.location.href = next;
            });
        })();
    </script>
</body>
</html>
